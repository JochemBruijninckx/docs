# Autoschedule row setting constraints

## BlockedHoursConstraint

**JSON:** `employeeAvailabilityConstraints`

**Rule ID:** `blockinghours_rule_id`

**XML:**

```xml
<BlockedHoursConstraint>
  <Block>
    <DayIndex>12</DayIndex>
    <TimeStart>00:00</TimeStart>
    <TimeEnd>24:00</TimeEnd>
  </Block>
</BlockedHoursConstraint>
```

**JSON:**

```json
"employeeAvailabilityConstraints": [
  {
    "id": "eac-off-on-day-12",
    "importance": "STRICT",
    "isDesired": false,
    "periods": {
      "days": {
        "dayIndices": [12]
      }
    }
  }
]
```

## DayRestRule

**JSON:** `periodicRestConstraints`

**Source:** `ScheduleRow.DayRestRule`

**XML:**

```xml
<DayRestRule>
  <Id>013N0068H001</Id>
  <Type>TIME</Type>
  <MinRestHours>11</MinRestHours>
  <TimeStart>0:00</TimeStart>
</DayRestRule>
```

**Note:** Start with ONE period rest

## WeeklyRestRule

**JSON:** `periodicRestConstraints`

**Source:** `ScheduleRow.WeeklyRestRule`

**XML:**

```xml
<WeeklyRestRule>
  <Id>013N0003100N</Id>
  <NbrOfDays>7</NbrOfDays>
  <MinRestHours>36</MinRestHours>
  <DayStart>6</DayStart>
  <TimeStart>14:00</TimeStart>
</WeeklyRestRule>
```

**Note:** Start with ONE period rest

## RestBetweenShifts

**JSON:** `cooldownConstraints`

**Parameter:** `min_hours_between_shifts = 15`

**XML:**

```xml
<RestBetweenShiftsConstraint>
  <Id>min_hours_between_shifts#15</Id>
  <MinRestHours>15</MinRestHours>
  <Types>
    <Type>WORK</Type>
  </Types>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</RestBetweenShiftsConstraint>
```

**JSON:**

```json
"cooldownConstraints": [
  {
    "id": "cd-min-15-hours",
    "importance": "STRICT",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    },
    "starts": {
      "shifts": {
        "labels": ["type:work"]
      }
    },
    "ends": {
      "shifts": {
        "labels": ["type:work"]
      }
    },
    "targets": {
      "minHours": 15
    }
  }
]
```

## WeekendDistributionConstraint

**JSON:** `periodDistributionConstraints`

**Parameters:**

- `max_weekends = 6`
- `free_neighbours = 1`

**XML:**

```xml
<WeekendDistributionConstraint>
  <Id>max_weekends#6#1</Id>
  <Weight>100</Weight>
  <Percentage>50.00</Percentage>
  <FreeNeighbours>1</FreeNeighbours>
  <Types>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Types>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</WeekendDistributionConstraint>
```

**JSON:**

```json
"periodDistributionConstraints": [
  {
    "id": "pdc-max-6",
    "importance": "STRICT",
    "maxWorkedPeriods": 6,
    "minSurroundingFreePeriods": 1,
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["type:work", "type:on-duty"]
      }
    },
    "periods": {
      "labels": ["weekends"]
    }
  }
]
```

### Min_weekends = 1

**XML:**

```xml
<WeekendDistributionConstraint>
  <Id>min_weekends#1#</Id>
  <Weight>100</Weight>
  <Percentage>8.33</Percentage>
  <Types>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Types>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</WeekendDistributionConstraint>
```

**JSON:**

```json
"periodDistributionConstraints": [
  {
    "id": "pdc-min-1",
    "importance": "STRICT",
    "minWorkedPeriods": 1,
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["type:work", "type:on-duty"]
      }
    },
    "periods": {
      "labels": ["weekends"]
    }
  }
]
```

## PointConstraint

**JSON:** `employeeAvailabilityConstraints`

**Parameter:** `unwanted_hours`

**XML:**

```xml
<PointConstraint>
  <Id>PREFERABLE_HOURS</Id>
  <Weight>99</Weight>
  <Interval>
    <!-- Weekday 1=Monday ... 7=Sunday !-->
    <WeekDay>1</WeekDay>
    <TimeStart>00:00</TimeStart>
    <TimeEnd>06:00</TimeEnd>
    <Points>4</Points>
    <Type>WORK</Type>
  </Interval>
  <Interval>
    <!-- Weekday 1=Monday ... 7=Sunday !-->
    <WeekDay>2</WeekDay>
    <TimeStart>00:00</TimeStart>
    <TimeEnd>06:00</TimeEnd>
    <Points>2</Points>
    <Type>WORK</Type>
  </Interval>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</PointConstraint>
```

**JSON:**

```json
"employeeAvailabilityConstraints": [
  {
    "id": "eac-monday-night",
    "importance": "HIGH",
    "isDesired": false,
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["type:work"]
      }
    },
    "periods": {
      "days": {
        "daysOfWeek": ["MON"],
        "startTime": "00:00",        // same as default, but included for clearness
        "endTime": "06:00"
      }
    }
  },
  {
    "id": "eac-tuesday-night",
    "importance": "MEDIUM",     // lower than for Monday, because of lower 'points'
    "isDesired": false
    // filters and periods similar to previous constraint, now starting on "TUE"
  }
]
```

## ShiftPatternConstraint

**Parameters:**

- `max_continous_shifts`
- `max_continous_dayoff = 3`

**Other parameters:**

- `min_continous_nights`
- `max_continous_nights`
- `min_continous_evenings`
- `max_continous_evenings`
- `max_continous_dutycall_shifts`
- `max_continous_onduty_shifts`

**XML:**

```xml
<ShiftPatternConstraint>
  <Id>max_continous_dayoff#3</Id>
  <Weight>-90</Weight>
  <Pattern>
    <ShiftType>DAYOFF</ShiftType>
    <ShiftType>DAYOFF</ShiftType>
    <ShiftType>DAYOFF</ShiftType>
    <ShiftType>DAYOFF</ShiftType>
  </Pattern>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftPatternConstraint>
```

**JSON:**

```json
"employeeUtilizationConstraints": [ // alternative
  {
    "id": "euc-max-3-consecutive-days-off",
    "importance": "VERY_HIGH",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    },
    "targets": {
      "minShifts": 1
    },
    "periods": {
      "recurrentDefinition": {
        "daysPerPeriod": 4,
        "daysBetweenStarts": 1
      }
    }
  }
]
```

_Note_: The 'day off' case is not supported on ConsecutiveConstraint, and the above example is a workaround for that.
The other examples (min/max consecutive night/evening/etc) are supported on ConsecutiveConstraint, like such:

```json
"consecutiveConstraints": [
  {
    "id": "cc-max-3-consecutive-nights",
    "importance": "STRICT",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["night"]
      }
    },
    "targets": {
      "max": 3
    }
  }
]
```

## ShiftUtilizationConstraint

**JSON:** `employeeUtilizationConstraints`

**Parameters:**

- `min_shift_length`
- `max_shift_length`
- `max_workdays = 57`
- `min_workdays = 20`

**XML:**

```xml
<ShiftUtilizationConstraint>
  <Id>max_workdays#57#20</Id>
  <Weight>100</Weight>
  <MaxOccurrence>57</MaxOccurrence>
  <MinOccurrence>20</MinOccurrence>
  <Shifts>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Shifts>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftUtilizationConstraint>
```

**JSON:**

```json
"employeeUtilizationConstraints": [
  {
    "id": "euc-days",
    "importance": "VERY_HIGH",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["type:work", "type:on-duty"]
      }
    },
    "targets": {
      "minShifts": 20,
      "maxShifts": 57
    }
  }
]
```

**Other parameters:**

- `max_evenings`
- `min_evenings`
- `max_nights = 10`
- `min_nights = 1`

### max_nights / min_nights

**XML:**

```xml
<ShiftUtilizationConstraint>
  <Id>max_nights#10#1</Id>
  <Weight>100</Weight>
  <MaxOccurrence>10</MaxOccurrence>
  <MinOccurrence>1</MinOccurrence>
  <Shifts>
    <Type>NIGHT_W_NEXT</Type>
    <Type>NIGHT_WD_NEXT</Type>
    <Type>NIGHT_W</Type>
    <Type>NIGHT_W_PREV</Type>
    <Type>NIGHT_WD_PREV</Type>
  </Shifts>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftUtilizationConstraint>
```

**JSON:**

```json
"employeeUtilizationConstraints": [
  {
    "id": "euc-nights",
    "importance": "VERY_HIGH",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      },
      "shifts": {
        "labels": ["night"]
      }
    },
    "targets": {
      "minShifts": 1,
      "maxShifts": 10
    }
  }
]
```

**Other parameters:**

- `max_undesirable_shifts`
- `min_undesirable_shifts`
- `max_dutycall_shifts`
- `min_dutycall_shifts`
- `max_onduty_shifts`
- `min_onduty_shifts`

### min_hours_week

**Source:** `Row.MinWeekHours`

**JSON:**

```json
"employeeUtilizationConstraints": [
  {
    "id": "euc-hours-per-week",
    "importance": "MEDIUM",
    "filters": {
      "employees": {
        "ids": ["X"]
      }
    },
    "targets": {
      "minHours": Y,
      "maxHours": Z
    },
    "periods": {
      "recurrentDefinition": {
        "daysPerPeriod": 7,
        "startDay": {
          "dayIndex": 0
        }
      }
    }
  }
]
```

### max_hours_week

**Source:** `Row.MaxWeekHours`

**Note:** See above

## ShiftLayoutConstraint

**JSON:** `cooldownConstraints`

**Parameter:** `days_between_undesirable = 3`

**XML:**

```xml
<ShiftLayoutConstraint>
  <Id>days_between_undesirable#3</Id>
  <Weight>100</Weight>
  <MinDays>3</MinDays>
  <Shifts>
    <Name>Dag2</Name>
    <Name>Kvzaezll</Name>
  </Shifts>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftLayoutConstraint>
```

**JSON:**

```json
"cooldownConstraints": [
  {
    "id": "cd-days-between-shifts",
    "importance": "STRICT",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    },
    "starts": {
      "shifts": {
        "ids": ["Dag2", "Kvzaezli"]
      }
    },
    "ends": {
      "shifts": {
        "ids": ["Dag2", "Kvzaezli"]
      }
    },
    "targets": {
      "minDays": 3
    }
  }
]
```

**Other parameters:**

- `days_between_onduty_shifts`

## ConsecutiveTimeOffConstraint

**JSON:** `consecutiveTimeOffConstraints`

**Parameters:**

- `min_longweekends = 1`
- `longweekend_days = 3`

**XML:**

```xml
<ConsecutiveTimeOffConstraint>
  <Id>min_longweekends#1#3</Id>
  <Weight>100</Weight>
  <MinNumberOfDays>3</MinNumberOfDays>
  <MinNumberOfWeeks>1</MinNumberOfWeeks>
  <Type>DAY_BASED</Type>
  <RequiredWeekDays>
    <WeekDay>6</WeekDay>
    <WeekDay>7</WeekDay>
  </RequiredWeekDays>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ConsecutiveTimeOffConstraint>
```

**JSON:**

```json
"consecutiveTimeOffConstraints": [
  {
    "id": "cto-long-weekends",
    "importance": "STRICT",
    "dayOffType": "DAY_BETWEEN_SHIFTS",
    "minNumberOfDays": 3,
    "minNumberOfWeeks": 1,
    "requiredWeekDaysOff": [6, 7],
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    }
  }
]
```

---

## XML-file based constraints with dynamic weight settings

### AdjustedTimeConstraints

**ID:** `RESCHEDULE_FAIR_HOURS`

**XML:**

```xml
<AdjustedTimeConstraint>
  <Id>RESCHEDULE_FAIR_HOURS</Id>
  <Weight>90</Weight>
  <RateAdjustFairness>false</RateAdjustFairness>
  <Types>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Types>
</AdjustedTimeConstraint>
```

**JSON:** Yet to be supported

### NewWorkingDayConstraints

**IDs:**

- `RESCHEDULE_FAIR_DAYS`
- `RESCHEDULE_FAIR_DAYS_WEEKEND`

**XML:**

```xml
<NewWorkingDayConstraint>
  <Id>RESCHEDULE_FAIR_DAYS_WEEKEND</Id>
  <Weight>99</Weight>
  <WeekDays>6#7</WeekDays>
  <Types>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Types>
</NewWorkingDayConstraint>
```

**JSON:** Yet to be supported

### ShiftPatternConstraint

**JSON:** `patternConstraints`

**ID:** `FRI_OFF_IF_SAT_SUN_MON`

**XML:**

```xml
<ShiftPatternConstraint>
  <Id>FRI_OFF_IF_SAT_SUN_MON</Id>
  <Weight>-90</Weight>
  <WeekDayStart>5</WeekDayStart>
  <Pattern>
    <ShiftType>!DAYOFF</ShiftType>
    <ShiftType>WORK#ON_DUTY</ShiftType>
    <ShiftType>WORK#ON_DUTY</ShiftType>
    <ShiftType>WORK#ON_DUTY</ShiftType>
  </Pattern>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftPatternConstraint>
```

**JSON:**

```json
"patternConstraints": [
  {
    "id": "pc-fri-off-if-sat-sun-mon",
    "importance": "MEDIUM",
    "isDesired": false,
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    },
    "patterns": [
      {
        "startDays": {
          "daysOfWeek": ["FRI"]
        },
        "patternDays": [
          {
            "keyword": "ANY_SHIFT"
          },
          {
            "shifts": {
              "labels": ["type:work", "type:on-duty"]
            }
          },
          {
            "shifts": {
              "labels": ["type:work", "type:on-duty"]
            }
          },
          {
            "shifts": {
              "labels": ["type:work", "type:on-duty"]
            }
          }
        ]
      }
    ]
  }
]
```

### ShiftUtilizationConstraint

**JSON:** `employeeUtilizationConstraints`

**ID:** `FAIR_EVENINGS`

**XML:**

```xml
<ShiftUtilizationConstraint>
  <Id>FAIR_EVENINGS</Id>
  <Weight>0</Weight>
  <Fairness>90</Fairness>
  <RateAdjustFairness>true</RateAdjustFairness>
  <MaxOccurrence>0</MaxOccurrence>
  <Shifts>
    <Type>EVENING_W</Type>
    <Type>EVENING_WD</Type>
    <Type>EVENING_D</Type>
  </Shifts>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</ShiftUtilizationConstraint>
```

**JSON:**

```json
{
  "constraints": {
    "employeeUtilizationConstraints": [
      {
        "id": "FAIR_EVENINGS_UTILIZATION",
        "importance": "NONE",
        "targets": {
          "idealShifts": 0
        },
        "filters": {
          "employees": {
            "ids": ["1", "2"]
          },
          "shifts": {
            "labels": ["evening"]
          }
        }
      }
    ],
    "fairnessConstraints": [
      {
        "id": "FAIR_EVENINGS",
        "importance": "HIGH",
        "constraintIds": ["FAIR_EVENINGS_UTILIZATION"],
        "applyWorkloadScaling": true
      }
    ]
  }
}
```

### WeekendDistributionConstraint

**JSON:** `periodDistributionConstraints`

**ID:** `FAIR_WEEKENDS`

**XML:**

```xml
<WeekendDistributionConstraint>
  <Id>FAIR_WEEKENDS</Id>
  <Weight>0</Weight>
  <Fairness>99</Fairness>
  <Percentage>100.00</Percentage>
  <Types>
    <Type>WORK</Type>
    <Type>ON_DUTY</Type>
  </Types>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</WeekendDistributionConstraint>
```

**JSON:**

```json
{
  "constraints": {
    "periodDistributionConstraints": [
      {
        "id": "AVOID_WEEKENDS",
        "importance": "NONE",
        "filters": {
          "employees": {
            "ids": ["1", "2"]
          },
          "shifts": {
            "labels": ["type:work", "type:on-duty"]
          }
        },
        "maxWorkedPeriods": 0,
        "periods": {
          "labels": ["WEEKENDS"]
        }
      }
    ],
    "fairnessConstraints": [
      {
        "id": "FAIR_WEEKENDS",
        "importance": "VERY_HIGH",
        "constraintIds": ["AVOID_WEEKENDS"]
      }
    ]
  },
  "configuration": {
    "periodLabels": [
      {
        "label": "WEEKENDS",
        "periods": {
          "recurrentDefinition": {
            "daysPerPeriod": 2,
            "daysBetweenStarts": 7,
            "startDay": {
              "date": "2024-12-21" // Starts on a Saturday, repeat every 7 days
            }
          }
        }
      }
    ]
  }
}
```

## WeeklyRestConstraint

**JSON:** `periodicRestConstraints`

**ID:** `WEEKLYRESTHOUR_45`

**XML:**

```xml
<WeeklyRestConstraint>
  <Id>WEEKLYRESTHOUR_45</Id>
  <Weight>50</Weight>
  <RestHours>45</RestHours>
  <ScheduleRows>
    <RowNbr>1</RowNbr>
    <RowNbr>2</RowNbr>
  </ScheduleRows>
</WeeklyRestConstraint>
```

**JSON:**

```json
"periodicRestConstraints": [
  {
    "id": "prc-weekly-45-hours",
    "importance": "MEDIUM",
    "filters": {
      "employees": {
        "ids": ["1", "2"]
      }
    },
    "minimumContinuousRestDuration": {
      "hours": 45
    },
    "periods": {
      "recurrentDefinition": {
        "daysPerPeriod": 7
      }
    }
  }
]
```
